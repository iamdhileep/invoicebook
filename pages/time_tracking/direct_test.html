<!DOCTYPE html>
<html>
<head>
    <title>Time Tracking Direct Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
</head>
<body>
    <div class="container mt-4">
        <h2>Time Tracking System - Direct Feature Test</h2>
        
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Quick Actions Test</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-success me-2" onclick="testManagerTools()">
                            <i class="bi bi-person-gear me-1"></i>Manager Tools
                        </button>
                        <button class="btn btn-primary" onclick="testSmartAttendance()">
                            <i class="bi bi-camera-fill me-1"></i>Smart Attendance Options
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>API Direct Test</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-info me-2" onclick="testAPI('refresh_stats')">Test Stats</button>
                        <button class="btn btn-warning" onclick="testAPI('get_team_counts')">Test Team Counts</button>
                        <div id="apiResult" class="mt-3" style="font-family: monospace; background: #f8f9fa; padding: 10px; border-radius: 5px; max-height: 200px; overflow-y: auto;"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Feature Status</h5>
                    </div>
                    <div class="card-body">
                        <div id="statusLog" style="font-family: monospace; background: #f8f9fa; padding: 10px; border-radius: 5px; max-height: 300px; overflow-y: auto;">
                            Initializing tests...<br>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Manager Tools Modal -->
    <div class="modal fade" id="managerToolsModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-person-gear me-2"></i>Manager Tools
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Manager Tools modal loaded successfully!</p>
                    <div class="alert alert-success">
                        ✓ Modal functionality is working
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Smart Attendance Modal -->
    <div class="modal fade" id="smartAttendanceModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-camera-fill me-2"></i>Smart Attendance Options
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Smart Attendance modal loaded successfully!</p>
                    <div class="alert alert-info">
                        ✓ Modal functionality is working
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function log(message) {
            const statusLog = document.getElementById('statusLog');
            const time = new Date().toLocaleTimeString();
            statusLog.innerHTML += `[${time}] ${message}<br>`;
            statusLog.scrollTop = statusLog.scrollHeight;
        }
        
        function testManagerTools() {
            log('Testing Manager Tools modal...');
            try {
                const modal = new bootstrap.Modal(document.getElementById('managerToolsModal'));
                modal.show();
                log('✓ Manager Tools modal opened successfully');
            } catch (error) {
                log('✗ Manager Tools modal failed: ' + error.message);
            }
        }
        
        function testSmartAttendance() {
            log('Testing Smart Attendance modal...');
            try {
                const modal = new bootstrap.Modal(document.getElementById('smartAttendanceModal'));
                modal.show();
                log('✓ Smart Attendance modal opened successfully');
            } catch (error) {
                log('✗ Smart Attendance modal failed: ' + error.message);
            }
        }
        
        function testAPI(action) {
            log(`Testing API action: ${action}...`);
            
            const formData = new FormData();
            formData.append('action', action);
            
            fetch('../api/time_tracking_api.php', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                log(`API Response Status: ${response.status}`);
                return response.text();
            })
            .then(text => {
                try {
                    const data = JSON.parse(text);
                    document.getElementById('apiResult').innerHTML = JSON.stringify(data, null, 2);
                    if (data.success) {
                        log(`✓ API ${action} successful`);
                    } else {
                        log(`ℹ API ${action} response: ${data.message}`);
                    }
                } catch (e) {
                    document.getElementById('apiResult').innerHTML = text;
                    log(`✗ API ${action} returned invalid JSON: ${text.substring(0, 100)}...`);
                }
            })
            .catch(error => {
                log(`✗ API ${action} failed: ${error.message}`);
                document.getElementById('apiResult').innerHTML = `Error: ${error.message}`;
            });
        }
        
        // Auto-run tests on page load
        document.addEventListener('DOMContentLoaded', function() {
            log('Page loaded, running initial tests...');
            
            // Test Bootstrap
            if (typeof bootstrap !== 'undefined') {
                log('✓ Bootstrap loaded successfully');
            } else {
                log('✗ Bootstrap not loaded');
            }
            
            // Test modal elements
            if (document.getElementById('managerToolsModal')) {
                log('✓ Manager Tools modal element found');
            } else {
                log('✗ Manager Tools modal element not found');
            }
            
            if (document.getElementById('smartAttendanceModal')) {
                log('✓ Smart Attendance modal element found');
            } else {
                log('✗ Smart Attendance modal element not found');
            }
            
            log('Initial tests completed. Ready for manual testing.');
        });
    </script>
</body>
</html>
