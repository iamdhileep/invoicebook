<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toggle Logic Diagnostic</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; }
        
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 280px;
            height: 100vh;
            background: #fff;
            border-right: 1px solid #ddd;
            transition: transform 0.3s ease;
            z-index: 1000;
            padding: 20px;
        }
        
        /* SIDEBAR STATES */
        .sidebar:not(.collapsed) {
            transform: translateX(0); /* VISIBLE */
            background: #e8f5e8; /* Green = visible */
        }
        
        .sidebar.collapsed {
            transform: translateX(-100%); /* HIDDEN */
            background: #ffe8e8; /* Red = hidden */
        }
        
        .top-header {
            position: fixed;
            top: 0;
            left: 280px; /* Starts next to visible sidebar */
            right: 0;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            padding: 0 1rem;
            transition: left 0.3s ease;
            z-index: 1030;
        }
        
        /* HEADER STATES */
        .top-header:not(.sidebar-collapsed) {
            left: 280px; /* Normal position when sidebar visible */
            background: linear-gradient(135deg, #67ea67 0%, #4ba276 100%); /* Green = normal */
        }
        
        .top-header.sidebar-collapsed {
            left: 0; /* Full width when sidebar hidden */
            background: linear-gradient(135deg, #ea6767 0%, #a24b4b 100%); /* Red = full width */
        }
        
        .main-content {
            margin-left: 280px; /* Starts with margin when sidebar visible */
            margin-top: 60px;
            padding: 20px;
            min-height: calc(100vh - 60px);
            transition: margin-left 0.3s ease;
        }
        
        /* MAIN CONTENT STATES */
        .main-content:not(.expanded) {
            margin-left: 280px; /* Normal margin when sidebar visible */
            background: #e8f5e8; /* Green = normal margin */
        }
        
        .main-content.expanded {
            margin-left: 0; /* Full width when sidebar hidden */
            background: #ffe8e8; /* Red = full width */
        }
        
        .sidebar-toggle {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.375rem;
        }
        
        .sidebar-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .diagnostic {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            z-index: 9999;
            max-width: 350px;
        }
        
        .expected {
            background: #2d5a2d;
            color: white;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="top-header" id="topHeader">
        <button class="sidebar-toggle" id="sidebarToggle">
            <i class="bi bi-list"></i>
        </button>
        <span class="ms-3 text-white fw-bold">Toggle Logic Diagnostic</span>
    </header>

    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <h5>Sidebar Content</h5>
        <div class="expected">
            <strong>Expected Behavior:</strong><br>
            <strong>Normal:</strong> Green (visible)<br>
            <strong>Collapsed:</strong> Red (hidden/slides left)
        </div>
        <ul class="list-unstyled">
            <li><a href="#">Dashboard</a></li>
            <li><a href="#">Products</a></li>
            <li><a href="#">Settings</a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <h1>Main Content Area</h1>
        
        <div class="expected">
            <strong>Expected Behavior:</strong><br>
            <strong>Normal:</strong> Green background = margin-left: 280px (sidebar visible)<br>
            <strong>Expanded:</strong> Red background = margin-left: 0 (sidebar hidden)
        </div>
        
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Current State Analysis</h5>
                    </div>
                    <div class="card-body">
                        <div id="stateAnalysis">
                            <p>Click the hamburger menu to test toggle behavior...</p>
                        </div>
                        
                        <div class="mt-3">
                            <button class="btn btn-primary" onclick="testToggle()">Manual Toggle</button>
                            <button class="btn btn-info ms-2" onclick="analyzeState()">Analyze State</button>
                            <button class="btn btn-warning ms-2" onclick="resetAll()">Reset All</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Diagnostic Panel -->
    <div class="diagnostic" id="diagnostic">
        <div><strong>Toggle Diagnostic:</strong></div>
        <div id="diagnosticDetails">Monitoring states...</div>
    </div>

    <script>
        let toggleCount = 0;
        
        function analyzeState() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const header = document.getElementById('topHeader');
            
            const sidebarCollapsed = sidebar?.classList.contains('collapsed');
            const mainContentExpanded = mainContent?.classList.contains('expanded');
            const headerCollapsed = header?.classList.contains('sidebar-collapsed');
            
            console.log('=== CURRENT STATE ===');
            console.log('Sidebar collapsed:', sidebarCollapsed);
            console.log('Main content expanded:', mainContentExpanded);
            console.log('Header full width:', headerCollapsed);
            
            const analysis = document.getElementById('stateAnalysis');
            const diagnostic = document.getElementById('diagnosticDetails');
            
            const isCorrect = (sidebarCollapsed === mainContentExpanded) && (sidebarCollapsed === headerCollapsed);
            
            analysis.innerHTML = `
                <strong>Current State (Toggle #${toggleCount}):</strong><br>
                • Sidebar collapsed: <span style="color: ${sidebarCollapsed ? 'red' : 'green'}">${sidebarCollapsed}</span><br>
                • Main content expanded: <span style="color: ${mainContentExpanded ? 'red' : 'green'}">${mainContentExpanded}</span><br>
                • Header full width: <span style="color: ${headerCollapsed ? 'red' : 'green'}">${headerCollapsed}</span><br>
                <br>
                <strong>Logic Check:</strong> <span style="color: ${isCorrect ? 'green' : 'red'}">${isCorrect ? 'CORRECT' : 'INCORRECT'}</span><br>
                <small>All three should match: all true (collapsed) or all false (normal)</small>
            `;
            
            diagnostic.innerHTML = `
                States: S:${sidebarCollapsed ? '1' : '0'} M:${mainContentExpanded ? '1' : '0'} H:${headerCollapsed ? '1' : '0'}<br>
                Match: ${isCorrect ? 'YES' : 'NO'}<br>
                Toggles: ${toggleCount}
            `;
        }
        
        function testToggle() {
            const toggleBtn = document.getElementById('sidebarToggle');
            if (toggleBtn) {
                toggleBtn.click();
            }
        }
        
        function resetAll() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const header = document.getElementById('topHeader');
            
            sidebar?.classList.remove('collapsed');
            mainContent?.classList.remove('expanded');
            header?.classList.remove('sidebar-collapsed');
            
            toggleCount = 0;
            localStorage.removeItem('sidebarCollapsed');
            analyzeState();
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            const sidebarToggle = document.getElementById('sidebarToggle');
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const header = document.getElementById('topHeader');
            
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', function(e) {
                    console.log('=== TOGGLE CLICKED ===');
                    e.preventDefault();
                    
                    toggleCount++;
                    
                    // Current implementation logic
                    const isCurrentlyCollapsed = sidebar?.classList.contains('collapsed');
                    console.log('Before toggle - collapsed:', isCurrentlyCollapsed);
                    
                    if (isCurrentlyCollapsed) {
                        // Expanding sidebar
                        sidebar?.classList.remove('collapsed');
                        mainContent?.classList.remove('expanded');
                        header?.classList.remove('sidebar-collapsed');
                        console.log('Action: Expanding sidebar');
                    } else {
                        // Collapsing sidebar
                        sidebar?.classList.add('collapsed');
                        mainContent?.classList.add('expanded');
                        header?.classList.add('sidebar-collapsed');
                        console.log('Action: Collapsing sidebar');
                    }
                    
                    setTimeout(analyzeState, 100);
                });
            }
            
            // Initial analysis
            analyzeState();
            
            // Auto-analyze every 3 seconds
            setInterval(analyzeState, 3000);
        });
    </script>
</body>
</html>
